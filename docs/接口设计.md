# **Todo-List æ¥å£è®¾è®¡æ–‡æ¡£**

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** V1.0
**ç¼–å†™äººï¼š** é¡¾æ™¨æ˜Š
**ç¼–å†™æ—¥æœŸï¼š** 2025å¹´07æœˆ04æ—¥
**æœ€åä¿®è®¢æ—¥æœŸï¼š** 2025å¹´07æœˆ04æ—¥

##  API æ¦‚è¿°

### 1.1 è®¾è®¡åŸåˆ™

æœ¬é¡¹ç›®APIéµå¾ªRESTfulè®¾è®¡è§„èŒƒï¼Œé‡‡ç”¨FastAPIæ¡†æ¶å¼€å‘ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

**æ ¸å¿ƒç‰¹æ€§**ï¼š
- **è‡ªåŠ¨æ–‡æ¡£ç”Ÿæˆ**ï¼šåŸºäºOpenAPI 3.0è§„èŒƒè‡ªåŠ¨ç”Ÿæˆäº¤äº’å¼APIæ–‡æ¡£
- **æ•°æ®éªŒè¯**ï¼šä½¿ç”¨Pydanticè¿›è¡Œè¯·æ±‚/å“åº”æ•°æ®éªŒè¯
- **ç±»å‹å®‰å…¨**ï¼šå®Œæ•´çš„ç±»å‹æ³¨è§£å’ŒéªŒè¯
- **ä¸­æ–‡åŒ–æ”¯æŒ**ï¼šæ¥å£æè¿°å’Œé”™è¯¯ä¿¡æ¯ä¸­æ–‡åŒ–
- **æ ‡å‡†åŒ–å“åº”**ï¼šç»Ÿä¸€çš„HTTPçŠ¶æ€ç å’Œé”™è¯¯å¤„ç†

### 1.2 åŸºç¡€ä¿¡æ¯

**æœåŠ¡åœ°å€**ï¼š
- å¼€å‘ç¯å¢ƒï¼š`http://127.0.0.1:8000`
- ç”Ÿäº§ç¯å¢ƒï¼š`https://api.todolist.com`

**APIæ–‡æ¡£åœ°å€**ï¼š
- Swagger UIï¼š`http://127.0.0.1:8000/docs`
- ReDocï¼š`http://127.0.0.1:8000/redoc`
- OpenAPI Schemaï¼š`http://127.0.0.1:8000/openapi.json`

**æ”¯æŒæ ¼å¼**ï¼š
- è¯·æ±‚æ ¼å¼ï¼š`application/json`
- å“åº”æ ¼å¼ï¼š`application/json`
- å­—ç¬¦ç¼–ç ï¼š`UTF-8`

---

##  API æ¨¡å—åˆ’åˆ†

### 2.1 åŠŸèƒ½æ¨¡å—

| æ¨¡å— | å‰ç¼€ | æè¿° | ä¸»è¦åŠŸèƒ½ |
|------|------|------|----------|
| **ä»»åŠ¡ç®¡ç†** | `/tasks` | å¾…åŠäº‹é¡¹ç®¡ç† | å¢åˆ æ”¹æŸ¥ã€æœç´¢ã€æ’åº |
| **ä¹ æƒ¯ç®¡ç†** | `/habits` | ä¹ æƒ¯å…»æˆç®¡ç† | ä¹ æƒ¯CRUDã€æ‰“å¡è®°å½• |
| **ç»Ÿè®¡åˆ†æ** | `/stats` | æ•°æ®ç»Ÿè®¡åˆ†æ | æ•ˆç‡ç»Ÿè®¡ã€è¶‹åŠ¿åˆ†æ |
| **ç³»ç»Ÿç®¡ç†** | `/system` | ç³»ç»ŸåŠŸèƒ½ | å¥åº·æ£€æŸ¥ã€é…ç½®ç®¡ç† |

### 2.2 æ•°æ®æ¨¡å‹å±‚æ¬¡

```
BaseModel (PydanticåŸºç±»)
â”œâ”€â”€ TaskBase (ä»»åŠ¡åŸºç¡€æ¨¡å‹)
â”‚   â”œâ”€â”€ TaskCreate (ä»»åŠ¡åˆ›å»º)
â”‚   â”œâ”€â”€ TaskUpdate (ä»»åŠ¡æ›´æ–°)
â”‚   â””â”€â”€ TaskOut (ä»»åŠ¡è¾“å‡º)
â”œâ”€â”€ HabitBase (ä¹ æƒ¯åŸºç¡€æ¨¡å‹)
â”‚   â”œâ”€â”€ HabitCreate (ä¹ æƒ¯åˆ›å»º)
â”‚   â”œâ”€â”€ HabitUpdate (ä¹ æƒ¯æ›´æ–°)
â”‚   â””â”€â”€ HabitOut (ä¹ æƒ¯è¾“å‡º)
â””â”€â”€ HabitLogCreate/Out (æ‰“å¡æ—¥å¿—)
```

---

##  ä»»åŠ¡ç®¡ç† API

### 3.1 åˆ›å»ºä»»åŠ¡

**æ¥å£ä¿¡æ¯**ï¼š
- **æ–¹æ³•**ï¼š`POST`
- **è·¯å¾„**ï¼š`/tasks`
- **æè¿°**ï¼šåˆ›å»ºæ–°çš„å¾…åŠä»»åŠ¡

**è¯·æ±‚å‚æ•°**ï¼š
```json
{
    "name": "å®Œæˆé¡¹ç›®æ–‡æ¡£",
    "description": "ç¼–å†™è¯¦ç»†çš„APIæ¥å£æ–‡æ¡£",
    "due_date": "2025-07-10T18:00:00",
    "importance": true,
    "urgent": false,
    "parent_id": null
}
```

**å‚æ•°è¯´æ˜**ï¼š
| å­—æ®µ | ç±»å‹ | å¿…å¡« | æè¿° | ç¤ºä¾‹ |
|------|------|------|------|------|
| name | string | æ˜¯ | ä»»åŠ¡åç§°ï¼Œæœ€å¤§255å­—ç¬¦ | "å®Œæˆé¡¹ç›®æ–‡æ¡£" |
| description | string | å¦ | ä»»åŠ¡æè¿° | "ç¼–å†™è¯¦ç»†çš„APIæ¥å£æ–‡æ¡£" |
| due_date | datetime | å¦ | æˆªæ­¢æ—¥æœŸï¼ŒISO 8601æ ¼å¼ | "2025-07-10T18:00:00" |
| importance | boolean | å¦ | æ˜¯å¦é‡è¦ï¼Œé»˜è®¤false | true |
| urgent | boolean | å¦ | æ˜¯å¦ç´§æ€¥ï¼Œé»˜è®¤false | false |
| parent_id | integer | å¦ | çˆ¶ä»»åŠ¡IDï¼Œç”¨äºåˆ›å»ºå­ä»»åŠ¡ | null |

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
    "id": 1,
    "name": "å®Œæˆé¡¹ç›®æ–‡æ¡£",
    "description": "ç¼–å†™è¯¦ç»†çš„APIæ¥å£æ–‡æ¡£",
    "due_date": "2025-07-10T18:00:00",
    "importance": true,
    "urgent": false,
    "parent_id": 0,
    "completed": false,
    "created_at": "2025-07-05T10:00:00.123456",
    "updated_at": "2025-07-05T10:00:00.123456"
}
```

**çŠ¶æ€ç **ï¼š
- `201`ï¼šåˆ›å»ºæˆåŠŸ
- `400`ï¼šè¯·æ±‚å‚æ•°é”™è¯¯
- `422`ï¼šæ•°æ®éªŒè¯å¤±è´¥

### 3.2 è·å–ä»»åŠ¡åˆ—è¡¨

**æ¥å£ä¿¡æ¯**ï¼š
- **æ–¹æ³•**ï¼š`GET`
- **è·¯å¾„**ï¼š`/tasks`
- **æè¿°**ï¼šè·å–ä»»åŠ¡åˆ—è¡¨ï¼Œæ”¯æŒè¿‡æ»¤å’Œæ’åº

**æŸ¥è¯¢å‚æ•°**ï¼š
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° | å¯é€‰å€¼ |
|------|------|------|------|--------|
| status | string | å¦ | ä»»åŠ¡çŠ¶æ€è¿‡æ»¤ | `all`, `pending`, `completed` |
| sort_by | string | å¦ | æ’åºæ–¹å¼ï¼Œé»˜è®¤priority | `priority`, `id`, `ddl` |

**è¯·æ±‚ç¤ºä¾‹**ï¼š
```http
GET /tasks?status=pending&sort_by=priority
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
[
    {
        "id": 1,
        "name": "å®Œæˆé¡¹ç›®æ–‡æ¡£",
        "description": "ç¼–å†™è¯¦ç»†çš„APIæ¥å£æ–‡æ¡£",
        "due_date": "2025-07-10T18:00:00",
        "importance": true,
        "urgent": false,
        "parent_id": 0,
        "completed": false,
        "created_at": "2025-07-05T10:00:00.123456",
        "updated_at": "2025-07-05T10:00:00.123456"
    },
    {
        "id": 2,
        "name": "ä»£ç å®¡æŸ¥",
        "description": "å®¡æŸ¥ä»»åŠ¡ç®¡ç†æ¨¡å—ä»£ç ",
        "due_date": "2025-07-08T17:00:00",
        "importance": false,
        "urgent": true,
        "parent_id": 0,
        "completed": false,
        "created_at": "2025-07-05T11:00:00.123456",
        "updated_at": "2025-07-05T11:00:00.123456"
    }
]
```

**çŠ¶æ€ç **ï¼š
- `200`ï¼šè·å–æˆåŠŸ
- `400`ï¼šæŸ¥è¯¢å‚æ•°é”™è¯¯

### 3.3 è·å–å•ä¸ªä»»åŠ¡

**æ¥å£ä¿¡æ¯**ï¼š
- **æ–¹æ³•**ï¼š`GET`
- **è·¯å¾„**ï¼š`/tasks/{task_id}`
- **æè¿°**ï¼šæ ¹æ®IDè·å–æŒ‡å®šä»»åŠ¡è¯¦æƒ…

**è·¯å¾„å‚æ•°**ï¼š
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| task_id | integer | æ˜¯ | ä»»åŠ¡ID |

**è¯·æ±‚ç¤ºä¾‹**ï¼š
```http
GET /tasks/1
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
    "id": 1,
    "name": "å®Œæˆé¡¹ç›®æ–‡æ¡£",
    "description": "ç¼–å†™è¯¦ç»†çš„APIæ¥å£æ–‡æ¡£",
    "due_date": "2025-07-10T18:00:00",
    "importance": true,
    "urgent": false,
    "parent_id": 0,
    "completed": false,
    "created_at": "2025-07-05T10:00:00.123456",
    "updated_at": "2025-07-05T10:00:00.123456"
}
```

**çŠ¶æ€ç **ï¼š
- `200`ï¼šè·å–æˆåŠŸ
- `404`ï¼šä»»åŠ¡ä¸å­˜åœ¨

### 3.4 æ›´æ–°ä»»åŠ¡

**æ¥å£ä¿¡æ¯**ï¼š
- **æ–¹æ³•**ï¼š`PATCH`
- **è·¯å¾„**ï¼š`/tasks/{task_id}`
- **æè¿°**ï¼šæ›´æ–°æŒ‡å®šä»»åŠ¡çš„éƒ¨åˆ†ä¿¡æ¯

**è·¯å¾„å‚æ•°**ï¼š
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| task_id | integer | æ˜¯ | ä»»åŠ¡ID |

**è¯·æ±‚å‚æ•°**ï¼ˆéƒ¨åˆ†æ›´æ–°ï¼‰ï¼š
```json
{
    "completed": true,
    "description": "APIæ¥å£æ–‡æ¡£å·²å®Œæˆç¼–å†™"
}
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
    "id": 1,
    "name": "å®Œæˆé¡¹ç›®æ–‡æ¡£",
    "description": "APIæ¥å£æ–‡æ¡£å·²å®Œæˆç¼–å†™",
    "due_date": "2025-07-10T18:00:00",
    "importance": true,
    "urgent": false,
    "parent_id": 0,
    "completed": true,
    "created_at": "2025-07-05T10:00:00.123456",
    "updated_at": "2025-07-05T14:30:00.789012"
}
```

**çŠ¶æ€ç **ï¼š
- `200`ï¼šæ›´æ–°æˆåŠŸ
- `400`ï¼šè¯·æ±‚å‚æ•°é”™è¯¯
- `404`ï¼šä»»åŠ¡ä¸å­˜åœ¨
- `422`ï¼šæ•°æ®éªŒè¯å¤±è´¥

### 3.5 åˆ é™¤ä»»åŠ¡

**æ¥å£ä¿¡æ¯**ï¼š
- **æ–¹æ³•**ï¼š`DELETE`
- **è·¯å¾„**ï¼š`/tasks/{task_id}`
- **æè¿°**ï¼šåˆ é™¤æŒ‡å®šä»»åŠ¡ï¼ˆåŒ…æ‹¬å­ä»»åŠ¡ï¼‰

**è·¯å¾„å‚æ•°**ï¼š
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| task_id | integer | æ˜¯ | ä»»åŠ¡ID |

**è¯·æ±‚ç¤ºä¾‹**ï¼š
```http
DELETE /tasks/1
```

**å“åº”**ï¼šæ— å†…å®¹ï¼ˆ204çŠ¶æ€ç ï¼‰

**çŠ¶æ€ç **ï¼š
- `204`ï¼šåˆ é™¤æˆåŠŸ
- `404`ï¼šä»»åŠ¡ä¸å­˜åœ¨

### 3.6 æœç´¢ä»»åŠ¡

**æ¥å£ä¿¡æ¯**ï¼š
- **æ–¹æ³•**ï¼š`GET`
- **è·¯å¾„**ï¼š`/tasks/search`
- **æè¿°**ï¼šæ ¹æ®å…³é”®è¯æœç´¢ä»»åŠ¡

**æŸ¥è¯¢å‚æ•°**ï¼š
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| q | string | æ˜¯ | æœç´¢å…³é”®è¯ï¼Œæœ€å°‘1ä¸ªå­—ç¬¦ |

**è¯·æ±‚ç¤ºä¾‹**ï¼š
```http
GET /tasks/search?q=æ–‡æ¡£
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
[
    {
        "id": 1,
        "name": "å®Œæˆé¡¹ç›®æ–‡æ¡£",
        "description": "ç¼–å†™è¯¦ç»†çš„APIæ¥å£æ–‡æ¡£",
        "due_date": "2025-07-10T18:00:00",
        "importance": true,
        "urgent": false,
        "parent_id": 0,
        "completed": false,
        "created_at": "2025-07-05T10:00:00.123456",
        "updated_at": "2025-07-05T10:00:00.123456"
    }
]
```

**çŠ¶æ€ç **ï¼š
- `200`ï¼šæœç´¢æˆåŠŸ
- `400`ï¼šæŸ¥è¯¢å‚æ•°é”™è¯¯

### 3.7 è·å–å­ä»»åŠ¡åˆ—è¡¨

**æ¥å£ä¿¡æ¯**ï¼š
- **æ–¹æ³•**ï¼š`GET`
- **è·¯å¾„**ï¼š`/tasks/{task_id}/children`
- **æè¿°**ï¼šè·å–æŒ‡å®šä»»åŠ¡çš„ç›´æ¥å­ä»»åŠ¡åˆ—è¡¨

**è·¯å¾„å‚æ•°**ï¼š
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| task_id | integer | æ˜¯ | çˆ¶ä»»åŠ¡ID |

**è¯·æ±‚ç¤ºä¾‹**ï¼š
```http
GET /tasks/1/children
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
[
    {
        "id": 3,
        "name": "ç¼–å†™éœ€æ±‚åˆ†æ",
        "description": "åˆ†æç”¨æˆ·éœ€æ±‚å’Œç³»ç»Ÿéœ€æ±‚",
        "due_date": "2025-07-07T18:00:00",
        "importance": true,
        "urgent": false,
        "parent_id": 1,
        "completed": false,
        "created_at": "2025-07-05T12:00:00.123456",
        "updated_at": "2025-07-05T12:00:00.123456"
    },
    {
        "id": 4,
        "name": "ç¼–å†™æ¥å£è®¾è®¡",
        "description": "è®¾è®¡APIæ¥å£è§„èŒƒ",
        "due_date": "2025-07-08T18:00:00",
        "importance": true,
        "urgent": false,
        "parent_id": 1,
        "completed": false,
        "created_at": "2025-07-05T12:30:00.123456",
        "updated_at": "2025-07-05T12:30:00.123456"
    }
]
```

**çŠ¶æ€ç **ï¼š
- `200`ï¼šè·å–æˆåŠŸ
- `404`ï¼šçˆ¶ä»»åŠ¡ä¸å­˜åœ¨

---

##  ä¹ æƒ¯ç®¡ç† API

### 4.1 åˆ›å»ºä¹ æƒ¯

**æ¥å£ä¿¡æ¯**ï¼š
- **æ–¹æ³•**ï¼š`POST`
- **è·¯å¾„**ï¼š`/habits`
- **æè¿°**ï¼šåˆ›å»ºæ–°çš„ä¹ æƒ¯

**è¯·æ±‚å‚æ•°**ï¼š
```json
{
    "name": "æ—©èµ·é”»ç‚¼",
    "description": "æ¯å¤©æ—©ä¸Š6ç‚¹èµ·åºŠé”»ç‚¼30åˆ†é’Ÿ",
    "duration": 21
}
```

**å‚æ•°è¯´æ˜**ï¼š
| å­—æ®µ | ç±»å‹ | å¿…å¡« | æè¿° | ç¤ºä¾‹ |
|------|------|------|------|------|
| name | string | æ˜¯ | ä¹ æƒ¯åç§°ï¼Œæœ€å¤§128å­—ç¬¦ | "æ—©èµ·é”»ç‚¼" |
| description | string | å¦ | ä¹ æƒ¯æè¿° | "æ¯å¤©æ—©ä¸Š6ç‚¹èµ·åºŠé”»ç‚¼30åˆ†é’Ÿ" |
| duration | integer | å¦ | ç›®æ ‡æŒç»­å¤©æ•°ï¼Œé»˜è®¤0 | 21 |

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
    "id": 1,
    "name": "æ—©èµ·é”»ç‚¼",
    "description": "æ¯å¤©æ—©ä¸Š6ç‚¹èµ·åºŠé”»ç‚¼30åˆ†é’Ÿ",
    "duration": 21,
    "logs": []
}
```

**çŠ¶æ€ç **ï¼š
- `201`ï¼šåˆ›å»ºæˆåŠŸ
- `400`ï¼šè¯·æ±‚å‚æ•°é”™è¯¯
- `422`ï¼šæ•°æ®éªŒè¯å¤±è´¥

### 4.2 è·å–ä¹ æƒ¯åˆ—è¡¨

**æ¥å£ä¿¡æ¯**ï¼š
- **æ–¹æ³•**ï¼š`GET`
- **è·¯å¾„**ï¼š`/habits`
- **æè¿°**ï¼šè·å–æ‰€æœ‰ä¹ æƒ¯åˆ—è¡¨

**è¯·æ±‚ç¤ºä¾‹**ï¼š
```http
GET /habits
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
[
    {
        "id": 1,
        "name": "æ—©èµ·é”»ç‚¼",
        "description": "æ¯å¤©æ—©ä¸Š6ç‚¹èµ·åºŠé”»ç‚¼30åˆ†é’Ÿ",
        "duration": 21,
        "logs": [
            {
                "id": 1,
                "habit_id": 1,
                "date": "2025-07-05T00:00:00"
            },
            {
                "id": 2,
                "habit_id": 1,
                "date": "2025-07-04T00:00:00"
            }
        ]
    },
    {
        "id": 2,
        "name": "é˜…è¯»",
        "description": "æ¯å¤©é˜…è¯»30åˆ†é’Ÿ",
        "duration": 30,
        "logs": []
    }
]
```

**çŠ¶æ€ç **ï¼š
- `200`ï¼šè·å–æˆåŠŸ

### 4.3 ä¹ æƒ¯æ‰“å¡

**æ¥å£ä¿¡æ¯**ï¼š
- **æ–¹æ³•**ï¼š`POST`
- **è·¯å¾„**ï¼š`/habits/{habit_id}/logs`
- **æè¿°**ï¼šä¸ºæŒ‡å®šä¹ æƒ¯è®°å½•æ‰“å¡

**è·¯å¾„å‚æ•°**ï¼š
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| habit_id | integer | æ˜¯ | ä¹ æƒ¯ID |

**è¯·æ±‚å‚æ•°**ï¼š
```json
{
    "date": "2025-07-05T00:00:00"
}
```

**å‚æ•°è¯´æ˜**ï¼š
| å­—æ®µ | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| date | datetime | å¦ | æ‰“å¡æ—¥æœŸï¼Œé»˜è®¤å½“å¤© |

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
    "id": 3,
    "habit_id": 1,
    "date": "2025-07-05T00:00:00"
}
```

**çŠ¶æ€ç **ï¼š
- `201`ï¼šæ‰“å¡æˆåŠŸ
- `400`ï¼šè¯·æ±‚å‚æ•°é”™è¯¯
- `404`ï¼šä¹ æƒ¯ä¸å­˜åœ¨
- `409`ï¼šä»Šæ—¥å·²æ‰“å¡

### 4.4 è·å–æ‰“å¡è®°å½•

**æ¥å£ä¿¡æ¯**ï¼š
- **æ–¹æ³•**ï¼š`GET`
- **è·¯å¾„**ï¼š`/habits/{habit_id}/logs`
- **æè¿°**ï¼šè·å–æŒ‡å®šä¹ æƒ¯çš„æ‰€æœ‰æ‰“å¡è®°å½•

**è·¯å¾„å‚æ•°**ï¼š
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| habit_id | integer | æ˜¯ | ä¹ æƒ¯ID |

**è¯·æ±‚ç¤ºä¾‹**ï¼š
```http
GET /habits/1/logs
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
[
    {
        "id": 3,
        "habit_id": 1,
        "date": "2025-07-05T00:00:00"
    },
    {
        "id": 2,
        "habit_id": 1,
        "date": "2025-07-04T00:00:00"
    },
    {
        "id": 1,
        "habit_id": 1,
        "date": "2025-07-03T00:00:00"
    }
]
```

**çŠ¶æ€ç **ï¼š
- `200`ï¼šè·å–æˆåŠŸ
- `404`ï¼šä¹ æƒ¯ä¸å­˜åœ¨

### 4.5 è·å–è¿ç»­æ‰“å¡å¤©æ•°

**æ¥å£ä¿¡æ¯**ï¼š
- **æ–¹æ³•**ï¼š`GET`
- **è·¯å¾„**ï¼š`/habits/{habit_id}/streak`
- **æè¿°**ï¼šè·å–æŒ‡å®šä¹ æƒ¯çš„å½“å‰è¿ç»­æ‰“å¡å¤©æ•°

**è·¯å¾„å‚æ•°**ï¼š
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| habit_id | integer | æ˜¯ | ä¹ æƒ¯ID |

**è¯·æ±‚ç¤ºä¾‹**ï¼š
```http
GET /habits/1/streak
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
7
```

**çŠ¶æ€ç **ï¼š
- `200`ï¼šè·å–æˆåŠŸ
- `404`ï¼šä¹ æƒ¯ä¸å­˜åœ¨

### 4.6 åˆ é™¤ä¹ æƒ¯

**æ¥å£ä¿¡æ¯**ï¼š
- **æ–¹æ³•**ï¼š`DELETE`
- **è·¯å¾„**ï¼š`/habits/{habit_id}`
- **æè¿°**ï¼šåˆ é™¤æŒ‡å®šä¹ æƒ¯åŠå…¶æ‰€æœ‰æ‰“å¡è®°å½•

**è·¯å¾„å‚æ•°**ï¼š
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| habit_id | integer | æ˜¯ | ä¹ æƒ¯ID |

**è¯·æ±‚ç¤ºä¾‹**ï¼š
```http
DELETE /habits/1
```

**å“åº”**ï¼šæ— å†…å®¹ï¼ˆ204çŠ¶æ€ç ï¼‰

**çŠ¶æ€ç **ï¼š
- `204`ï¼šåˆ é™¤æˆåŠŸ
- `404`ï¼šä¹ æƒ¯ä¸å­˜åœ¨

---

##  ç»Ÿè®¡åˆ†æ APIï¼ˆè§„åˆ’ä¸­ï¼‰

### 5.1 ä»»åŠ¡ç»Ÿè®¡

**æ¥å£ä¿¡æ¯**ï¼š
- **æ–¹æ³•**ï¼š`GET`
- **è·¯å¾„**ï¼š`/stats/tasks`
- **æè¿°**ï¼šè·å–ä»»åŠ¡å®Œæˆç»Ÿè®¡ä¿¡æ¯

**æŸ¥è¯¢å‚æ•°**ï¼š
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| start_date | date | å¦ | å¼€å§‹æ—¥æœŸ |
| end_date | date | å¦ | ç»“æŸæ—¥æœŸ |

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
    "total_tasks": 25,
    "completed_tasks": 18,
    "pending_tasks": 7,
    "completion_rate": 0.72,
    "daily_stats": [
        {
            "date": "2025-07-01",
            "created": 3,
            "completed": 2
        },
        {
            "date": "2025-07-02",
            "created": 2,
            "completed": 4
        }
    ]
}
```

### 5.2 ä¹ æƒ¯ç»Ÿè®¡

**æ¥å£ä¿¡æ¯**ï¼š
- **æ–¹æ³•**ï¼š`GET`
- **è·¯å¾„**ï¼š`/stats/habits`
- **æè¿°**ï¼šè·å–ä¹ æƒ¯å…»æˆç»Ÿè®¡ä¿¡æ¯

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
    "total_habits": 5,
    "active_habits": 3,
    "total_logs": 45,
    "habits_summary": [
        {
            "habit_id": 1,
            "habit_name": "æ—©èµ·é”»ç‚¼",
            "total_logs": 15,
            "current_streak": 7,
            "completion_rate": 0.85
        }
    ]
}
```

---

##  ç³»ç»Ÿç®¡ç† API

### 6.1 å¥åº·æ£€æŸ¥

**æ¥å£ä¿¡æ¯**ï¼š
- **æ–¹æ³•**ï¼š`GET`
- **è·¯å¾„**ï¼š`/health`
- **æè¿°**ï¼šæ£€æŸ¥APIæœåŠ¡çŠ¶æ€

**è¯·æ±‚ç¤ºä¾‹**ï¼š
```http
GET /health
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
    "status": "healthy",
    "timestamp": "2025-07-05T10:00:00.123456",
    "version": "1.0.0",
    "database": "connected"
}
```

### 6.2 APIä¿¡æ¯

**æ¥å£ä¿¡æ¯**ï¼š
- **æ–¹æ³•**ï¼š`GET`
- **è·¯å¾„**ï¼š`/info`
- **æè¿°**ï¼šè·å–APIåŸºæœ¬ä¿¡æ¯

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
    "name": "TodoList API",
    "version": "1.0.0",
    "description": "é«˜æ•ˆç”Ÿæ´» - TodoList ç®¡ç†ç³»ç»ŸAPI",
    "documentation": "http://127.0.0.1:8000/docs",
    "contact": {
        "name": "TodoList Team",
        "email": "team@todolist.com"
    }
}
```

---

##  æ•°æ®æ¨¡å‹å®šä¹‰

### 7.1 ä»»åŠ¡æ¨¡å‹

#### TaskBaseï¼ˆåŸºç¡€ä»»åŠ¡æ¨¡å‹ï¼‰
```json
{
    "name": "string (max 255)",
    "description": "string (nullable)",
    "due_date": "datetime (nullable)",
    "importance": "boolean (default: false)",
    "urgent": "boolean (default: false)",
    "parent_id": "integer (nullable)"
}
```

#### TaskCreateï¼ˆä»»åŠ¡åˆ›å»ºæ¨¡å‹ï¼‰
ç»§æ‰¿TaskBaseï¼Œç”¨äºåˆ›å»ºä»»åŠ¡æ—¶çš„æ•°æ®éªŒè¯ã€‚

#### TaskUpdateï¼ˆä»»åŠ¡æ›´æ–°æ¨¡å‹ï¼‰
```json
{
    "name": "string (optional, max 255)",
    "description": "string (optional)",
    "due_date": "datetime (optional)",
    "completed": "boolean (optional)",
    "importance": "boolean (optional)",
    "urgent": "boolean (optional)",
    "parent_id": "integer (optional)"
}
```

#### TaskOutï¼ˆä»»åŠ¡è¾“å‡ºæ¨¡å‹ï¼‰
```json
{
    "id": "integer",
    "name": "string",
    "description": "string (nullable)",
    "due_date": "datetime (nullable)",
    "importance": "boolean",
    "urgent": "boolean",
    "parent_id": "integer (0è¡¨ç¤ºnull)",
    "completed": "boolean",
    "created_at": "datetime",
    "updated_at": "datetime"
}
```

### 7.2 ä¹ æƒ¯æ¨¡å‹

#### HabitBaseï¼ˆåŸºç¡€ä¹ æƒ¯æ¨¡å‹ï¼‰
```json
{
    "name": "string (max 128)",
    "description": "string (nullable)",
    "duration": "integer (default: 0)"
}
```

#### HabitOutï¼ˆä¹ æƒ¯è¾“å‡ºæ¨¡å‹ï¼‰
```json
{
    "id": "integer",
    "name": "string",
    "description": "string (nullable)",
    "duration": "integer",
    "logs": "array of HabitLogOut"
}
```

#### HabitLogOutï¼ˆæ‰“å¡æ—¥å¿—è¾“å‡ºæ¨¡å‹ï¼‰
```json
{
    "id": "integer",
    "habit_id": "integer",
    "date": "datetime"
}
```

---

## å®‰å…¨ä¸è®¤è¯

### 8.1 å½“å‰å®‰å…¨æªæ–½

**æ•°æ®éªŒè¯**ï¼š
- Pydanticæ•°æ®æ¨¡å‹éªŒè¯
- SQLæ³¨å…¥é˜²æŠ¤ï¼ˆSQLAlchemy ORMï¼‰
- XSSé˜²æŠ¤ï¼ˆè¾“å…¥è½¬ä¹‰ï¼‰

**CORSé…ç½®**ï¼š
```python
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_methods=["*"],
    allow_headers=["*"],
)
```

### 8.2 å®‰å…¨æœ€ä½³å®è·µ

**å»ºè®®å®æ–½**ï¼š
- JWT Tokenè®¤è¯
- APIè®¿é—®é™æµ
- è¯·æ±‚å¤§å°é™åˆ¶
- HTTPSå¼ºåˆ¶ä½¿ç”¨
- æ•æ„Ÿæ•°æ®åŠ å¯†

---

## ğŸ“ˆ æ€§èƒ½ä¸ä¼˜åŒ–

### 9.1 æ€§èƒ½æŒ‡æ ‡

**å“åº”æ—¶é—´ç›®æ ‡**ï¼š
- GETè¯·æ±‚ï¼š< 200ms
- POST/PATCHè¯·æ±‚ï¼š< 500ms
- DELETEè¯·æ±‚ï¼š< 100ms
- æœç´¢è¯·æ±‚ï¼š< 1s

**å¹¶å‘æ”¯æŒ**ï¼š
- æ”¯æŒ100ä¸ªå¹¶å‘è¿æ¥
- æ•°æ®åº“è¿æ¥æ± ç®¡ç†
- å¼‚æ­¥è¯·æ±‚å¤„ç†

### 9.2 ä¼˜åŒ–ç­–ç•¥

**æ•°æ®åº“ä¼˜åŒ–**ï¼š
```sql
-- å»ºè®®çš„ç´¢å¼•
CREATE INDEX idx_task_name ON tasks(name);
CREATE INDEX idx_task_completed ON tasks(completed);
CREATE INDEX idx_task_due_date ON tasks(due_date);
CREATE INDEX idx_habit_name ON habits(name);
```

**ç¼“å­˜ç­–ç•¥**ï¼š
- æŸ¥è¯¢ç»“æœç¼“å­˜
- é™æ€èµ„æºç¼“å­˜
- APIå“åº”ç¼“å­˜

---

## æµ‹è¯•ä¸éªŒè¯

### 10.1 APIæµ‹è¯•ç”¨ä¾‹

#### ä»»åŠ¡ç®¡ç†æµ‹è¯•
```python
def test_create_task():
    """æµ‹è¯•åˆ›å»ºä»»åŠ¡"""
    response = client.post("/tasks", json={
        "name": "æµ‹è¯•ä»»åŠ¡",
        "importance": True,
        "urgent": False
    })
    assert response.status_code == 201
    assert response.json()["name"] == "æµ‹è¯•ä»»åŠ¡"

def test_get_tasks():
    """æµ‹è¯•è·å–ä»»åŠ¡åˆ—è¡¨"""
    response = client.get("/tasks?status=pending")
    assert response.status_code == 200
    assert isinstance(response.json(), list)

def test_search_tasks():
    """æµ‹è¯•æœç´¢ä»»åŠ¡"""
    response = client.get("/tasks/search?q=æµ‹è¯•")
    assert response.status_code == 200
```

#### ä¹ æƒ¯ç®¡ç†æµ‹è¯•
```python
def test_create_habit():
    """æµ‹è¯•åˆ›å»ºä¹ æƒ¯"""
    response = client.post("/habits", json={
        "name": "æµ‹è¯•ä¹ æƒ¯",
        "duration": 21
    })
    assert response.status_code == 201

def test_habit_log():
    """æµ‹è¯•ä¹ æƒ¯æ‰“å¡"""
    habit_id = 1
    response = client.post(f"/habits/{habit_id}/logs", json={})
    assert response.status_code == 201
```

### 10.2 é”™è¯¯åœºæ™¯æµ‹è¯•

```python
def test_task_not_found():
    """æµ‹è¯•ä»»åŠ¡ä¸å­˜åœ¨çš„æƒ…å†µ"""
    response = client.get("/tasks/999")
    assert response.status_code == 404

def test_duplicate_habit_log():
    """æµ‹è¯•é‡å¤æ‰“å¡"""
    habit_id = 1
    # ç¬¬ä¸€æ¬¡æ‰“å¡
    client.post(f"/habits/{habit_id}/logs", json={})
    # ç¬¬äºŒæ¬¡æ‰“å¡åº”è¯¥å¤±è´¥
    response = client.post(f"/habits/{habit_id}/logs", json={})
    assert response.status_code == 409
```

---

## APIä½¿ç”¨ç¤ºä¾‹

### 11.1 å®Œæ•´å·¥ä½œæµç¨‹ç¤ºä¾‹

#### JavaScript å®¢æˆ·ç«¯ç¤ºä¾‹
```javascript
const API_BASE = 'http://127.0.0.1:8000';

// 1. åˆ›å»ºä»»åŠ¡
async function createTask() {
    const response = await fetch(`${API_BASE}/tasks`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            name: 'å­¦ä¹ FastAPI',
            description: 'å®ŒæˆFastAPIæ•™ç¨‹å­¦ä¹ ',
            importance: true,
            urgent: false
        })
    });
    
    const task = await response.json();
    console.log('åˆ›å»ºçš„ä»»åŠ¡:', task);
    return task;
}

// 2. è·å–ä»»åŠ¡åˆ—è¡¨
async function getTasks() {
    const response = await fetch(`${API_BASE}/tasks?status=pending&sort_by=priority`);
    const tasks = await response.json();
    console.log('ä»»åŠ¡åˆ—è¡¨:', tasks);
    return tasks;
}

// 3. å®Œæˆä»»åŠ¡
async function completeTask(taskId) {
    const response = await fetch(`${API_BASE}/tasks/${taskId}`, {
        method: 'PATCH',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            completed: true
        })
    });
    
    const updatedTask = await response.json();
    console.log('ä»»åŠ¡å·²å®Œæˆ:', updatedTask);
    return updatedTask;
}

// 4. åˆ›å»ºä¹ æƒ¯
async function createHabit() {
    const response = await fetch(`${API_BASE}/habits`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            name: 'æ¯æ—¥å­¦ä¹ ',
            description: 'æ¯å¤©å­¦ä¹ 1å°æ—¶ç¼–ç¨‹',
            duration: 30
        })
    });
    
    const habit = await response.json();
    console.log('åˆ›å»ºçš„ä¹ æƒ¯:', habit);
    return habit;
}

// 5. ä¹ æƒ¯æ‰“å¡
async function logHabit(habitId) {
    const response = await fetch(`${API_BASE}/habits/${habitId}/logs`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({})
    });
    
    if (response.status === 409) {
        console.log('ä»Šæ—¥å·²æ‰“å¡');
        return;
    }
    
    const log = await response.json();
    console.log('æ‰“å¡æˆåŠŸ:', log);
    return log;
}
```

#### Python å®¢æˆ·ç«¯ç¤ºä¾‹
```python
import requests
import json
from datetime import datetime

API_BASE = 'http://127.0.0.1:8000'

class TodoListAPI:
    def __init__(self, base_url=API_BASE):
        self.base_url = base_url
    
    def create_task(self, name, description=None, due_date=None, importance=False, urgent=False):
        """åˆ›å»ºä»»åŠ¡"""
        data = {
            'name': name,
            'description': description,
            'due_date': due_date,
            'importance': importance,
            'urgent': urgent
        }
        response = requests.post(f'{self.base_url}/tasks', json=data)
        response.raise_for_status()
        return response.json()
    
    def get_tasks(self, status=None, sort_by='priority'):
        """è·å–ä»»åŠ¡åˆ—è¡¨"""
        params = {}
        if status:
            params['status'] = status
        params['sort_by'] = sort_by
        
        response = requests.get(f'{self.base_url}/tasks', params=params)
        response.raise_for_status()
        return response.json()
    
    def complete_task(self, task_id):
        """å®Œæˆä»»åŠ¡"""
        data = {'completed': True}
        response = requests.patch(f'{self.base_url}/tasks/{task_id}', json=data)
        response.raise_for_status()
        return response.json()
    
    def create_habit(self, name, description=None, duration=0):
        """åˆ›å»ºä¹ æƒ¯"""
        data = {
            'name': name,
            'description': description,
            'duration': duration
        }
        response = requests.post(f'{self.base_url}/habits', json=data)
        response.raise_for_status()
        return response.json()
    
    def log_habit(self, habit_id):
        """ä¹ æƒ¯æ‰“å¡"""
        data = {}
        response = requests.post(f'{self.base_url}/habits/{habit_id}/logs', json=data)
        if response.status_code == 409:
            print("ä»Šæ—¥å·²æ‰“å¡")
            return None
        response.raise_for_status()
        return response.json()

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == '__main__':
    api = TodoListAPI()
    
    # åˆ›å»ºä»»åŠ¡
    task = api.create_task(
        name="å­¦ä¹ APIè®¾è®¡",
        description="æ·±å…¥å­¦ä¹ RESTful APIè®¾è®¡åŸåˆ™",
        importance=True
    )
    print(f"åˆ›å»ºä»»åŠ¡: {task['name']}")
    
    # è·å–ä»»åŠ¡åˆ—è¡¨
    tasks = api.get_tasks(status='pending')
    print(f"å¾…åŠä»»åŠ¡æ•°é‡: {len(tasks)}")
    
    # åˆ›å»ºä¹ æƒ¯
    habit = api.create_habit(
        name="é˜…è¯»æŠ€æœ¯æ–‡æ¡£",
        description="æ¯å¤©é˜…è¯»30åˆ†é’ŸæŠ€æœ¯æ–‡æ¡£",
        duration=21
    )
    print(f"åˆ›å»ºä¹ æƒ¯: {habit['name']}")
    
    # ä¹ æƒ¯æ‰“å¡
    log = api.log_habit(habit['id'])
    if log:
        print(f"æ‰“å¡æˆåŠŸ: {log['date']}")
```

---

## ç›¸å…³èµ„æº

### 12.1 å¼€å‘å·¥å…·

**APIæ–‡æ¡£å·¥å…·**ï¼š
- Swagger UIï¼š`http://127.0.0.1:8000/docs`
- ReDocï¼š`http://127.0.0.1:8000/redoc`
- Postman Collectionï¼šå¯¼å‡ºOpenAPIè§„èŒƒ

**æµ‹è¯•å·¥å…·**ï¼š
- FastAPI TestClient
- Pytest
- HTTPieå‘½ä»¤è¡Œå·¥å…·

### 12.2 å‚è€ƒæ–‡æ¡£

- [FastAPIå®˜æ–¹æ–‡æ¡£](https://fastapi.tiangolo.com/)
- [Pydanticæ–‡æ¡£](https://docs.pydantic.dev/)
- [SQLAlchemyæ–‡æ¡£](https://docs.sqlalchemy.org/)
- [OpenAPIè§„èŒƒ](https://swagger.io/specification/)

---

## é™„å½•

### A.1 HTTPçŠ¶æ€ç è¯´æ˜

| çŠ¶æ€ç  | æè¿° | ä½¿ç”¨åœºæ™¯ |
|--------|------|----------|
| 200 | OK | GET, PATCHè¯·æ±‚æˆåŠŸ |
| 201 | Created | POSTè¯·æ±‚åˆ›å»ºæˆåŠŸ |
| 204 | No Content | DELETEè¯·æ±‚æˆåŠŸ |
| 400 | Bad Request | è¯·æ±‚å‚æ•°é”™è¯¯ |
| 404 | Not Found | èµ„æºä¸å­˜åœ¨ |
| 409 | Conflict | èµ„æºå†²çªï¼ˆå¦‚é‡å¤æ‰“å¡ï¼‰ |
| 422 | Unprocessable Entity | æ•°æ®éªŒè¯å¤±è´¥ |
| 500 | Internal Server Error | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |

### A.2 é”™è¯¯å“åº”æ ¼å¼

```json
{
    "detail": "é”™è¯¯æè¿°ä¿¡æ¯"
}
```

### A.3 æ—¥æœŸæ—¶é—´æ ¼å¼

**æ ‡å‡†æ ¼å¼**ï¼šISO 8601
- å®Œæ•´æ ¼å¼ï¼š`2025-07-05T14:30:00.123456`
- æ—¥æœŸæ ¼å¼ï¼š`2025-07-05`
- æ—¶åŒºå¤„ç†ï¼šé»˜è®¤UTCæ—¶é—´

---

## è”ç³»ä¿¡æ¯

**APIè´Ÿè´£äºº**ï¼š[é¡¾æ™¨æ˜Š]  
**æŠ€æœ¯è´Ÿè´£äºº**ï¼š[æé”¡æµ©]  
**äº§å“ç»ç†**ï¼š[ç‰›èŒ‚æ¶¦]  

[ä»“åº“é“¾æ¥](https://whucsgitlab.whu.edu.cn/devops/todolist)
[APIæœåŠ¡åœ°å€](http://127.0.0.1:8000)
[æ–‡æ¡£åœ°å€](http://127.0.0.1:8000/docs)

**æœ€åæ›´æ–°**ï¼š2025å¹´7æœˆ5æ—¥


---

*æœ¬APIæ¥å£æ–‡æ¡£å°†éšç€ç³»ç»ŸåŠŸèƒ½å‘å±•æŒç»­æ›´æ–°ï¼Œè¯·å…³æ³¨æœ€æ–°ç‰ˆæœ¬ã€‚*
