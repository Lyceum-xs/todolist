# To-Do List ç³»ç»Ÿè¯¦ç»†è®¾è®¡æ–‡æ¡£

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

| é¡¹ç›®ä¿¡æ¯ | è¯¦æƒ… |
|---------|------|
| **é¡¹ç›®åç§°** | é«˜æ•ˆç”Ÿæ´» - TodoList ç®¡ç†ç³»ç»Ÿ |
| **ç‰ˆæœ¬å·** | v1.0.0 |
| **æ–‡æ¡£ç‰ˆæœ¬** | v1.0 |
| **åˆ›å»ºæ—¥æœŸ** | 2025å¹´7æœˆ4æ—¥ |
| **æŠ€æœ¯æ ˆ** | FastAPI + SQLAlchemy + HTML/JavaScript/Tkinter |

---

## ğŸ¯ ç³»ç»Ÿæ¦‚è¿°

### 1.1 é¡¹ç›®èƒŒæ™¯
æœ¬é¡¹ç›®æ—¨åœ¨å¼€å‘ä¸€ä¸ªç°ä»£åŒ–çš„ä¸ªäººæ•ˆç‡ç®¡ç†ç³»ç»Ÿï¼Œé›†æˆä»»åŠ¡ç®¡ç†ã€ä¹ æƒ¯æ‰“å¡ã€ç•ªèŒ„é’Ÿå’Œæ—¥å†åŠŸèƒ½ï¼Œå¸®åŠ©ç”¨æˆ·æé«˜å·¥ä½œæ•ˆç‡å’Œç”Ÿæ´»è´¨é‡ã€‚

### 1.2 è®¾è®¡ç›®æ ‡
- **æ˜“ç”¨æ€§**ï¼šç®€æ´ç›´è§‚çš„ç”¨æˆ·ç•Œé¢
- **é«˜æ•ˆæ€§**ï¼šæ™ºèƒ½ä¼˜å…ˆçº§ç®—æ³•ï¼Œä¼˜åŒ–ä»»åŠ¡ç®¡ç†
- **æ‰©å±•æ€§**ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼Œä¾¿äºåŠŸèƒ½æ‰©å±•
- **ç¨³å®šæ€§**ï¼šå®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ•°æ®æŒä¹…åŒ–

### 1.3 æ ¸å¿ƒåŠŸèƒ½
1. **ä»»åŠ¡ç®¡ç†**ï¼šå¢åˆ æ”¹æŸ¥ã€ä¼˜å…ˆçº§è®¡ç®—ã€å±‚çº§ç»“æ„
2. **ä¹ æƒ¯æ‰“å¡**ï¼šä¹ æƒ¯ç®¡ç†ã€æ—¥å¿—è®°å½•ã€æ•°æ®ç»Ÿè®¡
3. **ç•ªèŒ„é’Ÿ**ï¼šä¸“æ³¨æ—¶é—´ç®¡ç†ã€å·¥ä½œç»Ÿè®¡
4. **æ—¥å†è§†å›¾**ï¼šä»»åŠ¡ä¸æ—¥æœŸå…³è”ã€å¯è§†åŒ–å±•ç¤º

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„è®¾è®¡

### 2.1 æ•´ä½“æ¶æ„

```mermaid
flowchart TD
    subgraph å‰ç«¯å±•ç¤ºå±‚["ğŸ–¥ï¸ å‰ç«¯å±•ç¤ºå±‚"]
        direction LR
        WebUI["ğŸ“± Webå‰ç«¯<br/>(HTML/JS/CSS)"]
        DesktopGUI["ğŸ’» Desktop GUI<br/>(Tkinter)"]
    end
    
    subgraph åº”ç”¨æœåŠ¡å±‚["âš™ï¸ åº”ç”¨æœåŠ¡å±‚"]
        direction LR
        Router["ğŸ”€ è·¯ç”±æ§åˆ¶<br/>(routers/)"]
        Service["ğŸ§  ä¸šåŠ¡é€»è¾‘<br/>(services/)"]
    end
    
    subgraph æ•°æ®è®¿é—®å±‚["ğŸ’¾ æ•°æ®è®¿é—®å±‚"]
        direction LR
        Models["ğŸ“‹ æ•°æ®æ¨¡å‹<br/>(models.py)"]
        CRUD["ğŸ”§ CRUDæ“ä½œ<br/>(crud.py)"]
    end
    
    subgraph æ•°æ®å­˜å‚¨å±‚["ğŸ—„ï¸ æ•°æ®å­˜å‚¨å±‚"]
        Database["ğŸ“Š SQLite æ•°æ®åº“"]
    end
    
    å‰ç«¯å±•ç¤ºå±‚ -->|HTTP API æ¥å£| åº”ç”¨æœåŠ¡å±‚
    åº”ç”¨æœåŠ¡å±‚ -->|æ•°æ®è®¿é—®æ¥å£| æ•°æ®è®¿é—®å±‚
    æ•°æ®è®¿é—®å±‚ --> æ•°æ®å­˜å‚¨å±‚
    
    classDef frontendStyle fill:#e5e7eb,stroke:#374151,stroke-width:2px,color:#1f2937
    classDef serviceStyle fill:#ddd6fe,stroke:#374151,stroke-width:2px,color:#1f2937
    classDef dataStyle fill:#fef3c7,stroke:#374151,stroke-width:2px,color:#1f2937
    classDef storageStyle fill:#d1fae5,stroke:#374151,stroke-width:2px,color:#1f2937
    
    class å‰ç«¯å±•ç¤ºå±‚ frontendStyle
    class åº”ç”¨æœåŠ¡å±‚ serviceStyle
    class æ•°æ®è®¿é—®å±‚ dataStyle
    class æ•°æ®å­˜å‚¨å±‚ storageStyle
```

### 2.2 æŠ€æœ¯æ¶æ„

| å±‚çº§ | æŠ€æœ¯é€‰å‹ | è¯´æ˜ |
|------|----------|------|
| **å‰ç«¯2.0** | HTML + CSS + JavaScript | å“åº”å¼Webç•Œé¢ |
| **GUI** | Python Tkinter | æ¡Œé¢åº”ç”¨ç•Œé¢ |
| **åç«¯** | FastAPI + Python 3.8+ | é«˜æ€§èƒ½å¼‚æ­¥Webæ¡†æ¶ |
| **ORM** | SQLAlchemy 2.0 | ç°ä»£åŒ–æ•°æ®åº“ORM |
| **æ•°æ®åº“** | SQLite | è½»é‡çº§åµŒå…¥å¼æ•°æ®åº“ |
| **éªŒè¯** | Pydantic v2 | æ•°æ®éªŒè¯å’Œåºåˆ—åŒ– |

---

## ğŸ“Š æ•°æ®åº“è®¾è®¡

### 3.1 æ•°æ®åº“å›¾

```mermaid
erDiagram
    tasks {
        int id PK "ä»»åŠ¡ID"
        varchar name "ä»»åŠ¡åç§°"
        varchar description "ä»»åŠ¡æè¿°"
        datetime due_date "æˆªæ­¢æ—¥æœŸ"
        boolean completed "æ˜¯å¦å®Œæˆ"
        boolean importance "æ˜¯å¦é‡è¦"
        boolean urgent "æ˜¯å¦ç´§æ€¥"
        int parent_id FK "çˆ¶ä»»åŠ¡ID"
        datetime created_at "åˆ›å»ºæ—¶é—´"
        datetime updated_at "æ›´æ–°æ—¶é—´"
    }

    habits {
        int id PK "ä¹ æƒ¯ID"
        varchar name "ä¹ æƒ¯åç§°"
        varchar description "ä¹ æƒ¯æè¿°"
        boolean completed "æ˜¯å¦å®Œæˆ"
        int duration "æŒç»­æ—¶é•¿"
    }

    habit_logs {
        int id PK "æ‰“å¡æ—¥å¿—ID"
        int habit_id FK "ä¹ æƒ¯ID"
        date date "æ‰“å¡æ—¥æœŸ"
    }

    tasks ||--o{ tasks : "has_subtask"
    habits ||--o{ habit_logs : "has_log"
```

### 3.2 æ•°æ®è¡¨è¯¦ç»†è®¾è®¡

#### 3.2.1 Taskï¼ˆä»»åŠ¡è¡¨ï¼‰

| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY | ä»»åŠ¡å”¯ä¸€æ ‡è¯† |
| name | VARCHAR(255) | NOT NULL, INDEX | ä»»åŠ¡åç§° |
| description | TEXT | NULLABLE | ä»»åŠ¡æè¿° |
| due_date | DATETIME | NULLABLE | æˆªæ­¢æ—¥æœŸ |
| completed | BOOLEAN | NOT NULL, DEFAULT FALSE | å®ŒæˆçŠ¶æ€ |
| importance | BOOLEAN | NOT NULL, DEFAULT FALSE | é‡è¦æ ‡è¯† |
| urgent | BOOLEAN | NOT NULL, DEFAULT FALSE | ç´§æ€¥æ ‡è¯† |
| parent_id | INTEGER | FOREIGN KEY, NULLABLE | çˆ¶ä»»åŠ¡ID |
| created_at | DATETIME | NOT NULL | åˆ›å»ºæ—¶é—´ |
| updated_at | DATETIME | NOT NULL | æ›´æ–°æ—¶é—´ |

**å…³ç³»è®¾è®¡**ï¼š
- è‡ªå¼•ç”¨å…³ç³»ï¼šæ”¯æŒçˆ¶å­ä»»åŠ¡ç»“æ„
- çº§è”åˆ é™¤ï¼šåˆ é™¤çˆ¶ä»»åŠ¡æ—¶ï¼Œå­ä»»åŠ¡ä¸€å¹¶åˆ é™¤

#### 3.2.2 Habitï¼ˆä¹ æƒ¯è¡¨ï¼‰

| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY | ä¹ æƒ¯å”¯ä¸€æ ‡è¯† |
| name | VARCHAR(128) | NOT NULL, UNIQUE | ä¹ æƒ¯åç§° |
| description | TEXT | NULLABLE | ä¹ æƒ¯æè¿° |
| completed | BOOLEAN | NOT NULL, DEFAULT FALSE | å½“æ—¥å®ŒæˆçŠ¶æ€ |
| duration | INTEGER | NOT NULL, DEFAULT 0 | æŒç»­å¤©æ•° |

#### 3.2.3 HabitLogï¼ˆä¹ æƒ¯æ—¥å¿—è¡¨ï¼‰

| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY | æ—¥å¿—å”¯ä¸€æ ‡è¯† |
| habit_id | INTEGER | FOREIGN KEY, NOT NULL | å…³è”ä¹ æƒ¯ID |
| date | DATE | NOT NULL, DEFAULT TODAY | æ‰“å¡æ—¥æœŸ |

**çº¦æŸè®¾è®¡**ï¼š
- å”¯ä¸€æ€§çº¦æŸï¼š`(habit_id, date)` ç¡®ä¿æ¯æ—¥åªèƒ½æ‰“å¡ä¸€æ¬¡

---

## ğŸ”§ APIæ¥å£è®¾è®¡

### 4.1 æ¥å£è§„èŒƒ

#### 4.1.1 é€šç”¨è§„èŒƒ
- **åè®®**ï¼šHTTP/HTTPS
- **æ•°æ®æ ¼å¼**ï¼šJSON
- **å­—ç¬¦ç¼–ç **ï¼šUTF-8
- **APIç‰ˆæœ¬**ï¼šv1
- **Base URL**ï¼š`http://127.0.0.1:8000`

#### 4.1.2 å“åº”çŠ¶æ€ç 
| çŠ¶æ€ç  | è¯´æ˜ |
|--------|------|
| 200 | è¯·æ±‚æˆåŠŸ |
| 201 | åˆ›å»ºæˆåŠŸ |
| 204 | åˆ é™¤æˆåŠŸ |
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ |
| 404 | èµ„æºä¸å­˜åœ¨ |
| 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |

### 4.2 ä»»åŠ¡ç®¡ç†API

#### 4.2.1 åˆ›å»ºä»»åŠ¡
```http
POST /tasks
Content-Type: application/json

{
    "name": "å®Œæˆé¡¹ç›®è®¾è®¡æ–‡æ¡£",
    "description": "ç¼–å†™è¯¦ç»†çš„ç³»ç»Ÿè®¾è®¡æ–‡æ¡£",
    "due_date": "2025-07-05T18:00:00",
    "importance": true,
    "urgent": false,
    "parent_id": null
}
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
    "id": 1,
    "name": "å®Œæˆé¡¹ç›®è®¾è®¡æ–‡æ¡£",
    "description": "ç¼–å†™è¯¦ç»†çš„ç³»ç»Ÿè®¾è®¡æ–‡æ¡£",
    "due_date": "2025-07-05T18:00:00",
    "completed": false,
    "importance": true,
    "urgent": false,
    "parent_id": 0,
    "created_at": "2025-07-04T10:00:00",
    "updated_at": "2025-07-04T10:00:00"
}
```

#### 4.2.2 è·å–ä»»åŠ¡åˆ—è¡¨
```http
GET /tasks?status=pending&sort_by=priority
```

**æŸ¥è¯¢å‚æ•°**ï¼š
- `status`: `all`|`pending`|`completed`
- `sort_by`: `priority`|`id`|`ddl`

#### 4.2.3 æ›´æ–°ä»»åŠ¡
```http
PATCH /tasks/{task_id}
Content-Type: application/json

{
    "completed": true
}
```

#### 4.2.4 åˆ é™¤ä»»åŠ¡
```http
DELETE /tasks/{task_id}
```

#### 4.2.5 æœç´¢ä»»åŠ¡
```http
GET /tasks/search?q=è®¾è®¡
```

#### 4.2.6 è·å–å­ä»»åŠ¡
```http
GET /tasks/{task_id}/children
```

### 4.3 ä¹ æƒ¯ç®¡ç†API

#### 4.3.1 åˆ›å»ºä¹ æƒ¯
```http
POST /habits
Content-Type: application/json

{
    "name": "æ—©èµ·é”»ç‚¼",
    "description": "æ¯å¤©æ—©ä¸Š6ç‚¹èµ·åºŠé”»ç‚¼30åˆ†é’Ÿ",
    "duration": 21
}
```

#### 4.3.2 ä¹ æƒ¯æ‰“å¡
```http
POST /habits/{habit_id}/logs
Content-Type: application/json

{}
```

#### 4.3.3 è·å–æ‰“å¡è®°å½•
```http
GET /habits/{habit_id}/logs
```

---

## ğŸ’¼ ä¸šåŠ¡é€»è¾‘è®¾è®¡

### 5.1 ä»»åŠ¡ä¼˜å…ˆçº§ç®—æ³•

#### 5.1.1 ç®—æ³•åŸç†
ä»»åŠ¡ä¼˜å…ˆçº§åŸºäºä¸‰ä¸ªç»´åº¦è®¡ç®—ï¼šé‡è¦æ€§ã€ç´§æ€¥æ€§ã€æˆªæ­¢æ—¥æœŸ

```python
def priority_parameter(self) -> float:
    """
    è®¡ç®—ä»»åŠ¡ä¼˜å…ˆçº§ (0~1)
    """
    if self.completed:
        return 0.0

    # æƒé‡é…ç½®
    importance_weight = 0.45  # é‡è¦æ€§æƒé‡
    urgent_weight = 0.45      # ç´§æ€¥æ€§æƒé‡
    due_date_weight = 0.10    # æˆªæ­¢æ—¥æœŸæƒé‡

    # åŸºç¡€å€¼è®¡ç®—
    importance_value = 1 if self.importance else 0
    urgent_value = 1 if self.urgent else 0

    # æˆªæ­¢æ—¥æœŸå¤„ç†
    if self.due_date:
        days_to_due = (self.due_date - datetime.now()).days
        if days_to_due < 0:
            due_date_value = 1.0  # å·²è¶…æœŸ
        else:
            due_date_value = 1 / (days_to_due + 1)
    else:
        due_date_value = 0.0  # æ— æˆªæ­¢æ—¥æœŸ

    return (
        importance_value * importance_weight +
        urgent_value * urgent_weight +
        due_date_value * due_date_weight
    )
```

#### 5.1.2 ä¼˜å…ˆçº§çŸ©é˜µ

| é‡è¦æ€§ | ç´§æ€¥æ€§ | åŸºç¡€å¾—åˆ† | æè¿° |
|--------|--------|----------|------|
| æ˜¯ | æ˜¯ | 0.90 | é‡è¦ä¸”ç´§æ€¥ï¼Œä¼˜å…ˆå¤„ç† |
| æ˜¯ | å¦ | 0.45 | é‡è¦ä¸ç´§æ€¥ï¼Œè®¡åˆ’å®‰æ’ |
| å¦ | æ˜¯ | 0.45 | ä¸é‡è¦ä½†ç´§æ€¥ï¼Œå¿«é€Ÿå¤„ç† |
| å¦ | å¦ | 0.00 | ä¸é‡è¦ä¸ç´§æ€¥ï¼Œå»¶åå¤„ç† |

### 5.2 ä¹ æƒ¯ç®¡ç†é€»è¾‘

#### 5.2.1 æ‰“å¡è§„åˆ™
- æ¯ä¸ªä¹ æƒ¯æ¯å¤©åªèƒ½æ‰“å¡ä¸€æ¬¡
- ä½¿ç”¨ `(habit_id, date)` å”¯ä¸€çº¦æŸç¡®ä¿æ•°æ®å®Œæ•´æ€§
- æ‰“å¡æ—¶è‡ªåŠ¨è®°å½•å½“å‰æ—¥æœŸ

#### 5.2.2 ä¹ æƒ¯ç»Ÿè®¡
- **è¿ç»­å¤©æ•°**ï¼šè®¡ç®—è¿ç»­æ‰“å¡çš„å¤©æ•°
- **å®Œæˆç‡**ï¼šè®¡ç®—æŒ‡å®šæ—¶é—´æ®µå†…çš„å®Œæˆç‡
- **è¶‹åŠ¿åˆ†æ**ï¼šå±•ç¤ºä¹ æƒ¯å®Œæˆçš„æ—¶é—´è¶‹åŠ¿

### 5.3 æ•°æ®éªŒè¯é€»è¾‘

#### 5.3.1 ä»»åŠ¡éªŒè¯
```python
class TaskCreate(BaseModel):
    name: str = Field(..., max_length=255)
    description: str | None = None
    due_date: datetime | None = None
    importance: bool = False
    urgent: bool = False
    parent_id: int | None = None
```

#### 5.3.2 éªŒè¯è§„åˆ™
- **ä»»åŠ¡åç§°**ï¼šå¿…å¡«ï¼Œæœ€å¤§é•¿åº¦255å­—ç¬¦
- **æˆªæ­¢æ—¥æœŸ**ï¼šå¯é€‰ï¼Œå¿…é¡»æ˜¯æœ‰æ•ˆçš„æ—¥æœŸæ—¶é—´æ ¼å¼
- **çˆ¶ä»»åŠ¡**ï¼šå¯é€‰ï¼Œå¿…é¡»æ˜¯å·²å­˜åœ¨çš„ä»»åŠ¡ID

---

## ğŸ¨ å‰ç«¯è®¾è®¡

### 6.1 ç•Œé¢è®¾è®¡

#### 6.1.1 è®¾è®¡ç†å¿µ
- **ç®€æ´æ€§**ï¼šç•Œé¢ç®€æ´ï¼Œæ“ä½œç›´è§‚
- **ä¸€è‡´æ€§**ï¼šç»Ÿä¸€çš„è§†è§‰è¯­è¨€å’Œäº¤äº’æ¨¡å¼
- **å“åº”æ€§**ï¼šé€‚é…ä¸åŒå±å¹•å°ºå¯¸
- **å¯è®¿é—®æ€§**ï¼šæ”¯æŒé”®ç›˜å¯¼èˆªå’Œå±å¹•é˜…è¯»å™¨

#### 6.1.2 Tkinter æ¡Œé¢ç«¯ç•Œé¢è®¾è®¡
- **ä¸»çª—å£**ï¼šåŒ…å«ä»»åŠ¡åˆ—è¡¨ã€ä¹ æƒ¯æ‰“å¡ã€ç•ªèŒ„é’Ÿç­‰Tabé¡µï¼Œé¡¶éƒ¨ä¸ºèœå•æ ï¼Œå·¦ä¾§ä¸ºåŠŸèƒ½å¯¼èˆªã€‚
- **ä»»åŠ¡åŒº**ï¼šä½¿ç”¨ Listbox æˆ– Treeview å±•ç¤ºä»»åŠ¡ï¼Œæ”¯æŒå‹¾é€‰å®Œæˆã€å³é”®èœå•ç¼–è¾‘/åˆ é™¤ã€‚
- **ä¹ æƒ¯åŒº**ï¼šä»¥åˆ—è¡¨æˆ–è¡¨æ ¼å½¢å¼å±•ç¤ºä¹ æƒ¯ï¼Œæ‰“å¡æŒ‰é’®ç›´æ¥æ“ä½œï¼Œæ‰“å¡åçŠ¶æ€å˜æ›´ã€‚
- **ç•ªèŒ„é’Ÿ**ï¼šç‹¬ç«‹Tabï¼Œæ˜¾ç¤ºå€’è®¡æ—¶ã€å¼€å§‹/æš‚åœ/é‡ç½®æŒ‰é’®ï¼Œå®Œæˆåå¼¹çª—æé†’ã€‚
- **äº¤äº’è¯´æ˜**ï¼šæ‰€æœ‰æ“ä½œå‡æœ‰å¼¹çª—æˆ–çŠ¶æ€æ åé¦ˆï¼Œç•Œé¢é£æ ¼ç®€æ´ï¼Œé€‚åˆWindowsé£æ ¼ã€‚

### 6.2 é¡µé¢ç»“æ„

#### 6.2.1 å¸ƒå±€è®¾è®¡
```mermaid
graph TD
    H[Header é¡µé¢å¤´éƒ¨]
    S[Sidebar ä¾§è¾¹æ ]
    M[Main Content ä¸»å†…å®¹åŒº]
    T[ä»»åŠ¡ç®¡ç†]
    H1[ä¹ æƒ¯æ‰“å¡]
    C[æ—¥å†è§†å›¾]
    Ti[ç•ªèŒ„é’Ÿ]
    Se[ç³»ç»Ÿè®¾ç½®]
    CA[Content Area å†…å®¹å±•ç¤ºåŒºåŸŸ]
    
    H --> S
    H --> M
    S --> T
    S --> H1
    S --> C
    S --> Ti
    S --> Se
    M --> CA
    
    classDef headerStyle fill:#4f46e5,stroke:#374151,stroke-width:2px,color:#ffffff
    classDef sidebarStyle fill:#6366f1,stroke:#374151,stroke-width:2px,color:#ffffff
    classDef contentStyle fill:#e5e7eb,stroke:#374151,stroke-width:2px,color:#1f2937
    classDef areaStyle fill:#ffffff,stroke:#374151,stroke-width:2px,color:#1f2937
    classDef menuStyle fill:#8b5cf6,stroke:#374151,stroke-width:1px,color:#ffffff
    
    class H headerStyle
    class S sidebarStyle
    class M contentStyle
    class CA areaStyle
    class T,H1,C,Ti,Se menuStyle
```

#### 6.2.2 ç»„ä»¶è®¾è®¡

**ä»»åŠ¡ç»„ä»¶**ï¼š
```html
<div class="task-item">
    <input type="checkbox" class="task-checkbox">
    <div class="task-content">
        <h3 class="task-title">ä»»åŠ¡åç§°</h3>
        <p class="task-description">ä»»åŠ¡æè¿°</p>
        <div class="task-meta">
            <span class="task-due-date">æˆªæ­¢æ—¥æœŸ</span>
            <span class="task-priority">ä¼˜å…ˆçº§</span>
        </div>
    </div>
    <div class="task-actions">
        <button class="edit-btn">ç¼–è¾‘</button>
        <button class="delete-btn">åˆ é™¤</button>
    </div>
</div>
```

### 6.3 äº¤äº’è®¾è®¡

#### 6.3.1 ä»»åŠ¡æ“ä½œæµç¨‹
1. **åˆ›å»ºä»»åŠ¡**ï¼šç‚¹å‡»"åˆ›å»ºä»»åŠ¡" â†’ å¡«å†™è¡¨å• â†’ æäº¤ä¿å­˜
2. **å®Œæˆä»»åŠ¡**ï¼šç‚¹å‡»å¤é€‰æ¡† â†’ ä»»åŠ¡çŠ¶æ€æ›´æ–° â†’ è§†è§‰åé¦ˆ
3. **ç¼–è¾‘ä»»åŠ¡**ï¼šç‚¹å‡»ç¼–è¾‘æŒ‰é’® â†’ å¼¹å‡ºç¼–è¾‘æ¡† â†’ ä¿®æ”¹ä¿å­˜
4. **åˆ é™¤ä»»åŠ¡**ï¼šç‚¹å‡»åˆ é™¤æŒ‰é’® â†’ ç¡®è®¤å¯¹è¯æ¡† â†’ åˆ é™¤æ“ä½œ

#### 6.3.2 ä¹ æƒ¯æ‰“å¡æµç¨‹
1. **æŸ¥çœ‹ä¹ æƒ¯**ï¼šè¿›å…¥ä¹ æƒ¯é¡µé¢ â†’ æ˜¾ç¤ºä¹ æƒ¯åˆ—è¡¨
2. **å®Œæˆæ‰“å¡**ï¼šç‚¹å‡»æ‰“å¡æŒ‰é’® â†’ è®°å½•æ‰“å¡ â†’ æ›´æ–°çŠ¶æ€

---

## ğŸ” å®‰å…¨è®¾è®¡

### 7.1 æ•°æ®å®‰å…¨

#### 7.1.1 è¾“å…¥éªŒè¯
- ä½¿ç”¨ Pydantic è¿›è¡Œæ•°æ®éªŒè¯
- SQLæ³¨å…¥é˜²æŠ¤ï¼šä½¿ç”¨ SQLAlchemy ORM

#### 7.1.2 æ•°æ®å®Œæ•´æ€§
- æ•°æ®åº“çº¦æŸï¼šå¤–é”®çº¦æŸã€å”¯ä¸€æ€§çº¦æŸ
- äº‹åŠ¡å¤„ç†ï¼šç¡®ä¿æ•°æ®ä¸€è‡´æ€§
- é”™è¯¯å¤„ç†ï¼šå¼‚å¸¸æ•è·å’Œé”™è¯¯å›æ»š


---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 8.1 æ•°æ®åº“ä¼˜åŒ–

#### 8.1.1 ç´¢å¼•ç­–ç•¥
```sql
-- ä»»åŠ¡è¡¨ç´¢å¼•
CREATE INDEX idx_task_name ON tasks(name);
CREATE INDEX idx_task_completed ON tasks(completed);
CREATE INDEX idx_task_due_date ON tasks(due_date);
CREATE INDEX idx_task_parent_id ON tasks(parent_id);

-- ä¹ æƒ¯è¡¨ç´¢å¼•
CREATE INDEX idx_habit_name ON habits(name);
CREATE INDEX idx_habitlog_date ON habit_logs(date);
```

#### 8.1.2 æŸ¥è¯¢ä¼˜åŒ–
- é¿å… N+1 æŸ¥è¯¢ï¼šä½¿ç”¨ SQLAlchemy çš„ `joinedload`
- åˆ†é¡µæŸ¥è¯¢ï¼šå¤§æ•°æ®é›†ä½¿ç”¨åˆ†é¡µ
- æŸ¥è¯¢ç¼“å­˜ï¼šé¢‘ç¹æŸ¥è¯¢ç»“æœç¼“å­˜

---

## ğŸ§ª æµ‹è¯•è®¾è®¡

### 9.1 æµ‹è¯•ç­–ç•¥

#### 9.1.1 æµ‹è¯•åˆ†å±‚

```mermaid
flowchart TD
    subgraph é›†æˆæµ‹è¯•["ğŸ”— é›†æˆæµ‹è¯•å±‚"]
        direction TB
        A1["APIæ¥å£æµ‹è¯•"]
        A2["ç«¯åˆ°ç«¯æµ‹è¯•"]
        A3["ç³»ç»Ÿé›†æˆæµ‹è¯•"]
    end
    
    subgraph å•å…ƒæµ‹è¯•["ğŸ§ª å•å…ƒæµ‹è¯•å±‚"]
        direction TB
        B1["ä¸šåŠ¡é€»è¾‘æµ‹è¯•"]
        B2["æ•°æ®æ¨¡å‹æµ‹è¯•"]
        B3["å·¥å…·å‡½æ•°æµ‹è¯•"]
    end
    
    é›†æˆæµ‹è¯• --> å•å…ƒæµ‹è¯•
    
    classDef integrationStyle fill:#4f46e5,stroke:#374151,stroke-width:2px,color:#ffffff
    classDef unitStyle fill:#10b981,stroke:#374151,stroke-width:2px,color:#ffffff
    
    class é›†æˆæµ‹è¯• integrationStyle
    class å•å…ƒæµ‹è¯• unitStyle
```


### 9.2 æµ‹è¯•ç”¨ä¾‹è®¾è®¡

#### 9.2.1 ä»»åŠ¡ç®¡ç†æµ‹è¯•
```python
def test_task_crud_and_subtree():
    """æµ‹è¯•ä»»åŠ¡çš„CRUDæ“ä½œå’Œå­ä»»åŠ¡åŠŸèƒ½"""
    # åˆ›å»ºçˆ¶ä»»åŠ¡
    response = client.post("/tasks", json={
        "name": "çˆ¶ä»»åŠ¡",
        "importance": True,
        "urgent": False
    })
    assert response.status_code == 201
    parent_id = response.json()["id"]
    
    # åˆ›å»ºå­ä»»åŠ¡
    client.post("/tasks", json={
        "name": "å­ä»»åŠ¡1",
        "parent_id": parent_id
    })
    
    # éªŒè¯å­ä»»åŠ¡æ•°é‡
    response = client.get(f"/tasks/{parent_id}/children")
    assert len(response.json()) == 1
```

#### 9.2.2 ä¼˜å…ˆçº§ç®—æ³•æµ‹è¯•
```python
def test_priority_calculation():
    """æµ‹è¯•ä»»åŠ¡ä¼˜å…ˆçº§è®¡ç®—ç®—æ³•"""
    # é‡è¦ä¸”ç´§æ€¥çš„ä»»åŠ¡
    task1 = Task(importance=True, urgent=True, completed=False)
    assert task1.priority_parameter == 0.9
    
    # å·²å®Œæˆçš„ä»»åŠ¡
    task2 = Task(completed=True)
    assert task2.priority_parameter == 0.0
```

#### 9.2.3 Apifoxå’Œswagger uiçš„åŠŸèƒ½æ€§èƒ½æµ‹è¯•
å…·ä½“è§æœ¬é¡¹ç›®æµ‹è¯•æ–‡æ¡£

---

## ğŸš€ éƒ¨ç½²æ–¹æ¡ˆ

### 10.1 å¼€å‘ç¯å¢ƒ

#### 10.1.1 ç¯å¢ƒè¦æ±‚
- Python 3.8+
- Node.js 16+ (å‰ç«¯å¼€å‘)
- SQLite 3.x

#### 10.1.2 å¯åŠ¨æ­¥éª¤
```bash
# 1. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv .venv
source .venv/bin/activate  # Windows: .venv\Scripts\activate

# 2. å®‰è£…ä¾èµ–
pip install -r requirements-dev.txt

# 3. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
uvicorn src.app.main:app --reload

# 4. å¯åŠ¨æ¡Œé¢åº”ç”¨
python run.py
```

---


## ğŸ“ è”ç³»ä¿¡æ¯

**é¡¹ç›®å›¢é˜Ÿ**ï¼šTodoList å¼€å‘å›¢é˜Ÿ  
**æŠ€æœ¯è´Ÿè´£äºº**ï¼šç‰›èŒ‚æ¶¦ æ¨æ™“èˆ’ æé”¡æµ© ä¸¥æ™¨ é¡¾æ™¨æ˜Š  
**é¡¹ç›®ç»ç†**ï¼šç‰›èŒ‚æ¶¦  
**æ–‡æ¡£ç»´æŠ¤**ï¼šä¸¥æ™¨ æé”¡æµ©  
**æœ€åæ›´æ–°**ï¼š2025å¹´7æœˆ4æ—¥

---

